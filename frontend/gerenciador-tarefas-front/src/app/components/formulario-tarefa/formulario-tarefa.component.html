<div class="overlay" (click)="fecharFormulario()"></div>

<div class="modal" (click)="$event.stopPropagation()">
  <div class="modal-header">
    <h2>
      <mat-icon>{{ tarefa ? 'edit' : 'add_circle' }}</mat-icon>
      {{ tarefa ? 'Editar Tarefa' : 'Nova Tarefa' }}
    </h2>
    <button mat-icon-button (click)="fecharFormulario()" type="button">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <form [formGroup]="formulario" (ngSubmit)="onSubmit()">
    <div class="modal-content">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Título</mat-label>
        <input matInput 
               formControlName="titulo" 
               placeholder="Digite o título da tarefa"
               maxlength="100">
        <mat-icon matPrefix>title</mat-icon>
        <mat-hint align="end">{{ titulo?.value?.length || 0 }}/100</mat-hint>
        <mat-error *ngIf="titulo?.invalid && titulo?.touched">
          {{ getMensagemErro('titulo') }}
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Descrição</mat-label>
        <textarea matInput 
                  formControlName="descricao" 
                  placeholder="Adicione uma descrição (opcional)"
                  rows="4"
                  maxlength="500"></textarea>
        <mat-icon matPrefix>description</mat-icon>
        <mat-hint align="end">{{ descricao?.value?.length || 0 }}/500</mat-hint>
        <mat-error *ngIf="descricao?.invalid && descricao?.touched">
          {{ getMensagemErro('descricao') }}
        </mat-error>
      </mat-form-field>

      <mat-checkbox formControlName="concluida" color="primary">
        Tarefa concluída
      </mat-checkbox>
    </div>

    <div class="modal-actions">
      <button mat-stroked-button type="button" (click)="fecharFormulario()" [disabled]="carregando">
        Cancelar
      </button>
      <button mat-raised-button color="primary" type="submit" [disabled]="carregando || formulario.invalid">
        <mat-spinner *ngIf="carregando" diameter="20"></mat-spinner>
        <mat-icon *ngIf="!carregando">{{ tarefa ? 'save' : 'add' }}</mat-icon>
        {{ carregando ? 'Salvando...' : (tarefa ? 'Salvar' : 'Criar') }}
      </button>
    </div>
  </form>
</div>
